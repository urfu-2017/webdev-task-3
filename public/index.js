!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);const i="https://qoter.now.sh/places";var n={createPlace:async function(e){const t=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e,description:""})});return await t.json()},updatePlace:async function(e){await fetch(i+`/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})},deletePlace:async function(e){await fetch(i+`/${e.id}`,{method:"DELETE"})},getAllPlaces:async function(){const e=await fetch(i);return await e.json()},deleteAllPlaces:async function(){await fetch(i,{method:"DELETE"})},reorder:async function(e,t){await fetch(i+"/order",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({draggedId:e,droppedId:t})})}};class a{constructor(e){this.className=e}show(){this.elem.style.display=""}hide(){this.elem.style.display="none"}createElement(){throw Error(`createElement is not implemented ${typeof this}`)}toggleClass(e){this.elem.className!==this.className?this.elem.className=this.className:this.elem.className=`${this.className} ${e}`}render(){return this.elem=this.createElement(),this.className&&(this.elem.className=this.className),this.elem}}const l=13;class c extends a{constructor({className:e,enterHandler:t,maxLength:s}){super(e),this.enterHandler=t,this.maxLength=s}setValue(e){this.elem.value=e}getValue(){return this.elem.value}createElement(){const e=document.createElement("input");return e.type="text",this.maxLength&&(e.maxLength=this.maxLength),e.onkeydown=(async e=>{this.enterHandler&&e.keyCode===l&&await this.enterHandler()}),e}}class r extends a{constructor({className:e,clickHandler:t,image:s}){super(e),this.clickHandler=t,this.image=s}createElement(){const e=document.createElement("input");return e.type="button",e.onclick=this.clickHandler,this.image&&this.setupImageStyles(e),e}setupImageStyles(e){e.style.backgroundImage=`url('${this.image}')`,e.style.backgroundSize="20px 20px",e.style.width="20px",e.style.height="20px",e.style.border="none",e.style.cursor="pointer"}}class d extends a{constructor({className:e,clickHandler:t,checked:s}){super(e),this.clickHandler=t,this.checked=s}createElement(){const e=document.createElement("input");return e.type="checkbox",e.checked=this.checked,e.onclick=(async()=>{this.checked=!this.checked,await this.clickHandler()}),e}}class h extends a{constructor({className:e,value:t}){super(e),this.value=t}getValue(){return this.elem.innerText}setValue(e){this.elem.innerText=e}createElement(){const e=document.createElement("span");return e.innerText=this.value,e}}class o extends a{constructor(e){super("place"),this.place=e,this.editButton=new r({className:"place__btn",clickHandler:()=>this.edit(),image:"/img/edit-btn.svg"}),this.deleteButton=new r({className:"place__btn",clickHandler:async()=>await this.delete(),image:"/img/delete-btn.svg"}),this.saveButton=new r({className:"place__btn",clickHandler:async()=>await this.save(),image:"/img/save-btn.svg"}),this.undoButton=new r({className:"place__btn",clickHandler:()=>this.undo(),image:"/img/undo-btn.svg"}),this.titleInput=new c({className:"place__input",enterHandler:async()=>await this.save(),maxLength:22}),this.title=new h({className:"place__titleText",value:this.place.title}),this.visitedCheckbox=new d({className:"place__checkbox",clickHandler:async()=>await this.toggleVisited(),checked:this.place.visited})}normal(){this.hideAll(),this.title.show(),this.visitedCheckbox.show()}hover(){this.normal(),this.editButton.show(),this.deleteButton.show()}edit(){this.hideAll(),this.titleInput.setValue(this.title.getValue()),this.titleInput.show(),this.titleInput.elem.focus(),this.saveButton.show(),this.undoButton.show()}async delete(){this.elem.outerHTML="",this.ondelete&&this.ondelete(),await n.deletePlace(this.place)}async save(){const e=this.titleInput.getValue();this.title.setValue(e),this.place.title=e,this.hover(),await n.updatePlace(this.place)}undo(){this.hover()}async toggleVisited(){this.place.visited=this.visitedCheckbox.checked,await n.updatePlace(this.place)}hideAll(){this.editButton.hide(),this.deleteButton.hide(),this.saveButton.hide(),this.undoButton.hide(),this.titleInput.hide(),this.title.hide(),this.visitedCheckbox.hide()}createControls(){const e=document.createElement("div");return e.classList="place__controls",e.appendChild(this.editButton.render()),e.appendChild(this.deleteButton.render()),e.appendChild(this.saveButton.render()),e.appendChild(this.undoButton.render()),e}createTitle(){const e=document.createElement("div");return e.className="place__title",e.appendChild(this.titleInput.render()),e.appendChild(this.title.render()),e}createVisit(){const e=document.createElement("div");return e.className="place__visit",e.appendChild(this.visitedCheckbox.render()),e}createElement(){const e=this.createControls(),t=this.createTitle(),s=this.createVisit(),i=document.createElement("div");return i.appendChild(e),i.appendChild(t),i.appendChild(s),i.onmouseenter=(()=>this.hover()),i.onmouseleave=(()=>this.normal()),this.normal(),i}}class u extends a{constructor(e){super("place-container"),this.places=e.map(e=>new o(e)),this.draggedId=""}filter(e){this.places.forEach(t=>{t.show(),e(t.place)||t.hide()})}async addPlace(e){const t=new o({title:e,visited:!1});this.renderToElement(t,this.elem),this.places.push(t);const s=await n.createPlace(e);t.place.id=s.id}renderToElement(e,t){return t.appendChild(e.render()),this.setupDragAndDrop(e),e.ondelete=(()=>{this.places=this.places.filter(t=>t!==e)}),e}setupDragAndDrop(e){e.elem.draggable=!0,e.elem.ondragstart=(()=>{this.draggedId=e.place.id}),e.elem.ondragover=(e=>{e.preventDefault()}),e.elem.ondragenter=(()=>{this.droppedId=e.place.id,e.elem.style.background="#eee"}),e.elem.ondragleave=(()=>{e.elem.style.background="#fff"}),e.elem.ondrop=(async()=>{e.elem.style.background="#fff",this.updateOrder(this.draggedId,this.droppedId),this.elem.innerHTML="",this.places.forEach(e=>this.elem.appendChild(e.elem)),await n.reorder(this.draggedId,this.droppedId)})}updateOrder(e,t){const s=this.places.findIndex(t=>t.place.id===e),i=this.places.findIndex(e=>e.place.id===t),n=this.places[s];i>s?this.places.splice(s,i-s,...this.places.slice(s+1,i+1)):i<s&&this.places.splice(i+1,s-i,...this.places.slice(i,s)),this.places[i]=n}createElement(){var e=document.createElement("div");return this.places.forEach(t=>{this.renderToElement(t,e)}),e}}class p extends a{constructor(){super("footer")}createElement(){const e=document.createElement("div");return e.innerText="Qoter 2018",e}}class m extends a{constructor(e){super("search"),this.input=new c({className:"search__input",enterHandler:()=>e(this.input.getValue())}),this.button=new r({className:"search__button",clickHandler:()=>e(this.input.getValue()),image:"/img/search-btn.svg"})}createElement(){const e=document.createElement("div");return e.appendChild(this.input.render()),e.appendChild(this.button.render()),e}}class g extends a{constructor(e){super("creator"),this.input=new c({className:"creator__input",enterHandler:async()=>await e(this.input.getValue()),maxLength:22}),this.button=new r({className:"creator__button",clickHandler:async()=>await e(this.input.getValue()),image:"/img/add-btn.svg"})}clear(){this.input.setValue("")}createElement(){const e=document.createElement("div");return e.appendChild(this.input.render()),e.appendChild(this.button.render()),e}}class v extends a{constructor({className:e,clickHandler:t,name:s,value:i}){super(e),this.clickHandler=t,this.name=s,this.value=i}click(){this.elem.click()}createElement(){const e=document.createElement("input");e.style.display="none",e.type="radio",e.name=this.name,e.onclick=this.clickHandler;const t=document.createElement("span");t.innerText=this.value;const s=document.createElement("label");return s.appendChild(e),s.appendChild(t),s}}class w extends a{constructor(e){super("selector"),this.items=e.map(e=>new v({className:"selector__item",clickHandler:e.clickHandler,name:"switch",value:e.value}))}createElement(){const e=document.createElement("div");return this.items.forEach(t=>e.appendChild(t.render())),e}}window.onload=(async()=>{var e=new class extends a{constructor(e){super("main"),this.search=new m(e=>this.filterSearch(e)),this.creator=new g(async e=>await this.addPlace(e)),this.selector=new w([{value:"all",clickHandler:()=>this.filter(()=>!0)},{value:"visited",clickHandler:()=>this.filter(e=>e.visited)},{value:"unvisited",clickHandler:()=>this.filter(e=>!e.visited)}]),this.places=new u(e),this.footer=new p}filterSearch(e){this.places.filter(t=>this.currentFilter(t)&&t.title.includes(e))}filter(e){this.currentFilter=e,this.places.filter(e)}async addPlace(e){this.creator.clear(),await this.places.addPlace(e),this.filter(()=>!0)}createElement(){const e=document.createElement("div");return e.appendChild(this.search.render()),e.appendChild(this.creator.render()),e.appendChild(this.selector.render()),e.appendChild(this.places.render()),e.appendChild(this.footer.render()),this.selector.items[0].click(),e}}(await n.getAllPlaces());document.getElementById("root").appendChild(e.render())})}]);